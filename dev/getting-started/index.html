<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Getting started · PostgresORM documentation</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">PostgresORM documentation</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Index</a></li><li class="is-active"><a class="tocitem" href>Getting started</a><ul class="internal"><li><a class="tocitem" href="#Pre-requisites"><span>Pre-requisites</span></a></li><li><a class="tocitem" href="#Example-projects"><span>Example projects</span></a></li><li><a class="tocitem" href="#Concepts"><span>Concepts</span></a></li><li><a class="tocitem" href="#Reverse-engineer-the-database"><span>Reverse engineer the database</span></a></li></ul></li><li><span class="tocitem">Modules</span><ul><li><a class="tocitem" href="../modules/PostgresORM/">Module PostgresORM</a></li><li><a class="tocitem" href="../modules/PostgresORM.Controller/">Module PostgresORM.Controller</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Getting started</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Getting started</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaPostgresORM/PostgresORM.jl/blob/master/docs/src/getting-started.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Getting-started"><a class="docs-heading-anchor" href="#Getting-started">Getting started</a><a id="Getting-started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-started" title="Permalink"></a></h1><h2 id="Pre-requisites"><a class="docs-heading-anchor" href="#Pre-requisites">Pre-requisites</a><a id="Pre-requisites-1"></a><a class="docs-heading-anchor-permalink" href="#Pre-requisites" title="Permalink"></a></h2><h3 id="Install-LibPQ.jl"><a class="docs-heading-anchor" href="#Install-LibPQ.jl">Install LibPQ.jl</a><a id="Install-LibPQ.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Install-LibPQ.jl" title="Permalink"></a></h3><p><code>MyProject&gt; add LibPQ</code></p><h3 id="Install-PostgresORM.jl"><a class="docs-heading-anchor" href="#Install-PostgresORM.jl">Install PostgresORM.jl</a><a id="Install-PostgresORM.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Install-PostgresORM.jl" title="Permalink"></a></h3><p><code>MyProject&gt; add https://github.com/JuliaPostgresORM/PostgresORM.jl</code></p><h2 id="Example-projects"><a class="docs-heading-anchor" href="#Example-projects">Example projects</a><a id="Example-projects-1"></a><a class="docs-heading-anchor-permalink" href="#Example-projects" title="Permalink"></a></h2><p>You can look at the following projects to see how PostgresORM is used :</p><ul><li><a href="https://github.com/JuliaPostgresORM/IMDBTestApp.jl">IMDBTestApp.jl</a></li></ul><h2 id="Concepts"><a class="docs-heading-anchor" href="#Concepts">Concepts</a><a id="Concepts-1"></a><a class="docs-heading-anchor-permalink" href="#Concepts" title="Permalink"></a></h2><h3 id="Classes"><a class="docs-heading-anchor" href="#Classes">Classes</a><a id="Classes-1"></a><a class="docs-heading-anchor-permalink" href="#Classes" title="Permalink"></a></h3><p>PostgreSQL tables are mapped to mutable composite types that inherit the abstract type PostgresORM.IEntity.</p><p>For the sake of conciseness we call this particular type a <em>class</em>.</p><p>A <em>class</em> looks like this :</p><pre><code class="language-none">mutable struct Film &lt;: IFilm

  id::Union{Missing,Int32}
  codeName::Union{Missing,String}
  year::Union{Missing,Int16}
  actorFilmAssos::Union{Missing,Vector{Model.IActorFilmAsso}}

  Film(args::NamedTuple) = Film(;args...)
  Film(;
    id = missing,
    codeName = missing,
    year = missing,
    actorFilmAssos = missing,
  ) = (
    x = new(missing,missing,missing,missing,);
    x.id = id;
    x.codeName = codeName;
    x.year = year;
    x.actorFilmAssos = actorFilmAssos;
    return x
  )

end</code></pre><p>Lets describe the key aspects of a <em>class</em>:</p><h4 id="A-*class*-inherits-an-abstract-type-that-inherits-IEntity"><a class="docs-heading-anchor" href="#A-*class*-inherits-an-abstract-type-that-inherits-IEntity">A <em>class</em> inherits an abstract type that inherits IEntity</a><a id="A-*class*-inherits-an-abstract-type-that-inherits-IEntity-1"></a><a class="docs-heading-anchor-permalink" href="#A-*class*-inherits-an-abstract-type-that-inherits-IEntity" title="Permalink"></a></h4><p><code>mutable struct Film &lt;: IFilm</code> where <code>IFilm &lt;: PostgresORM.IEntity</code></p><p>This allows us to avoid circular dependencies</p><h4 id="Fields-of-a-class-are-all-Union-of-a-Missing-and-something-else"><a class="docs-heading-anchor" href="#Fields-of-a-class-are-all-Union-of-a-Missing-and-something-else">Fields of a class are all Union of a Missing and something else</a><a id="Fields-of-a-class-are-all-Union-of-a-Missing-and-something-else-1"></a><a class="docs-heading-anchor-permalink" href="#Fields-of-a-class-are-all-Union-of-a-Missing-and-something-else" title="Permalink"></a></h4><p><code>id::Union{Missing,Int32}</code></p><p>The &#39;something else&#39; can be a lot of things including a <code>IEntity</code> or a vector of <code>IEntity</code>.</p><p>In this documentation we call</p><ul><li>A &#39;<em>complex property</em>&#39;, a property of type <code>IEntity</code>. It is also named</li></ul><p>a &quot;manyToOne&quot; property and it resolves to a foreign key in the table of the   <em>class</em>.</p><ul><li>A &#39;<em>property of IEntities</em>&#39;, a property of type </li></ul><p><code>Vector{T} where T &lt;: IEntity</code>.  It is also named a &quot;oneToMany&quot; property and   it is the counter part of a <em>complex property</em> in another <em>class</em>.</p><h4 id="A-*class*-has-two-constructors"><a class="docs-heading-anchor" href="#A-*class*-has-two-constructors">A <em>class</em> has two constructors</a><a id="A-*class*-has-two-constructors-1"></a><a class="docs-heading-anchor-permalink" href="#A-*class*-has-two-constructors" title="Permalink"></a></h4><ol><li>A constructor that takes a NamedTuple and that is required by PostgresORM</li></ol><p>function. It calls the second constructor by splatting the NamedTuple.</p><ol><li>A constructor that takes optional named arguments with default values</li></ol><p><code>missing</code> and that assign the values to the matching properties.</p><p>Therefore:</p><ul><li>Calling <code>Film()</code> creates an instance of <em>Film</em> with all properties set</li></ul><p>to <code>missing</code></p><ul><li>Calling <code>Film(id = 34, codeName = &quot;cube&quot;)</code> creates an instance of <em>Film</em></li></ul><p>with all properties set to <code>missing</code> except <em>id</em> and <em>codeName</em></p><h3 id="ORM-modules"><a class="docs-heading-anchor" href="#ORM-modules">ORM modules</a><a id="ORM-modules-1"></a><a class="docs-heading-anchor-permalink" href="#ORM-modules" title="Permalink"></a></h3><p>An ORM module is a Julia module that tells PostgresORM how to handle a <em>class</em>. It contains the following:</p><ul><li><code>data_type = Model.Film</code>: Assigns the module variable <code>data_type</code> to the</li></ul><p><em>class</em> associated with the ORM module</p><ul><li><code>PostgresORM.get_orm(x::Model.Film) = return(ORM.FilmORM)</code>: Declares a new</li></ul><p>method of function <code>PostgresORM.get_orm</code>, this function is used to tell   PostgresORM which ORM module to use for a given <em>class</em></p><ul><li><code>get_schema_name() = &quot;public&quot;</code>: Returns the PostgreSQL schema name of the</li></ul><p>table associated with the <em>class</em></p><ul><li><code>get_table_name() = &quot;film&quot;</code>: Returns the table name associated with the <em>class</em>  </li><li><code>get_columns_selection_and_mapping()</code>: Returns the mapping between julia</li></ul><p>fields and table columns. Note that  a <em>complex property</em> can be mapped to   an array of columns if the foreign key has multiple columns (i.e. if the   <em>class</em> of the <em>complex</em>property_ has a composite id)</p><ul><li><code>get_id_props()</code>: Returns the fields that make the id of the <em>class</em>. These</li></ul><p>fields can be <em>complex properties</em></p><ul><li><code>get_onetomany_counterparts()</code>: It gives for every <em>property of IEntities</em>  </li></ul><p>the associated <em>complex property</em> (i.e. manyToOne property)</p><ul><li><code>get_types_override()</code>: It gives for every oneToMany or manyToOne property</li></ul><p>the real type of the property</p><p>Some optional functions for the tracking of changes:</p><ul><li><code>get_track_changes()</code>: Tells PostgresORM to record all the changes made to</li></ul><p>instances of the <em>class</em></p><ul><li><code>get_creator_property()</code>: Tells which property holds the reference of the</li></ul><p>user that created the instance. This property must inherit <code>PostgresORM.AppUser</code></p><ul><li><code>get_editor_property()</code>: Tells which property holds the reference of the</li></ul><p>user that last edited the instance. This property must inherit <code>PostgresORM.AppUser</code></p><ul><li><code>get_creation_time_property()</code>: Tells which property holds the creation</li></ul><p>time of the instance</p><ul><li><code>get_update_time_property()</code>: Tells which property holds the last update</li></ul><p>time of the instance</p><h3 id="Enums"><a class="docs-heading-anchor" href="#Enums">Enums</a><a id="Enums-1"></a><a class="docs-heading-anchor-permalink" href="#Enums" title="Permalink"></a></h3><p>Julia enums are the counterpart of PostgreSQL custom enumeration types.</p><h3 id="LibPQ-connection"><a class="docs-heading-anchor" href="#LibPQ-connection">LibPQ connection</a><a id="LibPQ-connection-1"></a><a class="docs-heading-anchor-permalink" href="#LibPQ-connection" title="Permalink"></a></h3><p>Many PostgresORM functions expects a <code>LibPQ.Connection</code> as one of the arguments. The developer is in charge of managing the connections and the transactions.</p><h2 id="Reverse-engineer-the-database"><a class="docs-heading-anchor" href="#Reverse-engineer-the-database">Reverse engineer the database</a><a id="Reverse-engineer-the-database-1"></a><a class="docs-heading-anchor-permalink" href="#Reverse-engineer-the-database" title="Permalink"></a></h2><p>The easiest way to get started is to ask PostgresORM to generate the <em>classes</em>, the ORM modules and the enums. Once done, you can copy the files in the <em>src</em> folder of the project and declare everything in the project (see how it&#39;s done in <a href="https://github.com/JuliaPostgresORM/IMDBTestApp.jl">IMDBTestApp.jl</a>).</p><p>Here is an example of script to reverse engineer a database:</p><pre><code class="language-none">out_dir = (@__DIR__) * &quot;/out&quot;
dbconn = begin
    database = &quot;imdbtestapp&quot;
    user = &quot;imdbtestapp&quot;
    host = &quot;127.0.0.1&quot;
    port = &quot;5432&quot;
    password = &quot;1234&quot;

    LibPQ.Connection(&quot;host=$(host)
                      port=$(port)
                      dbname=$(database)
                      user=$(user)
                      password=$(password)
                      &quot;; throw_error=true)
    end
PostgresORM.Tool.generate_julia_code(dbconn,out_dir)

close(dbconn)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Index</a><a class="docs-footer-nextpage" href="../modules/PostgresORM/">Module PostgresORM »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 10 June 2021 22:03">Thursday 10 June 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
